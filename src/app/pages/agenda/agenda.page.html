<ion-content class="agenda-container" fullscreen>

  <!-- Topo com usuário e logout -->
  <div class="top-info ion-padding">
    <div class="user-header">
      <img [src]="photoURL" alt="avatar" class="avatar" />
      <div class="user-info">
        <div class="user-top">
          <h3 class="username">{{ name }}</h3>
          <button class="logout-button" (click)="logout()">
            <img src="assets/icon/enter-sharp.png" alt="logout" />
          </button>
        </div>

        <!-- Date picker -->
        <div class="date-picker ion-margin-top">
          <label>Selecione uma data:</label>
          <button class="calendar-button" (click)="showDatePicker = true">
            <img src="assets/icon/calendar.png" alt="calendar" />
            <span *ngIf="selectedDate">{{ selectedDate }}</span>
            <span *ngIf="!selectedDate">Escolher</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Date picker modal -->
  <ion-datetime
    *ngIf="showDatePicker"
    presentation="date"
    (ionChange)="onDateSelected($event)"
    (ionCancel)="showDatePicker = false"
  ></ion-datetime>

  <!-- Lista de Aulas / Agenda -->
  <ion-card class="ion-margin" *ngIf="selectedDate && agendaItems.length > 0">
    <ion-card-header>
      <h2 class="card-title">Agenda do dia {{ selectedDate }}</h2>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let item of agendaItems" [color]="item.cor">
          <img [src]="item.imagem" alt="avatar" class="avatar" />
          <ion-label>
            <h3>{{ item.nome }}</h3>
            <p>Início: {{ item.horarioInicio || '-' }}</p>
            <p>Fim: {{ item.horarioFim || '-' }}</p>
            <p>Status: {{ item.status }}</p>
          </ion-label>

          <!-- Aluno: botão Marcar -->
          <ion-button
            *ngIf="role === 'aluno' && item.status === 'Disponível'"
            slot="end"
            size="small"
            (click)="abrirModal(item.id)">
            Marcar
          </ion-button>

          <!-- Professor: botões Confirmar e Cancelar -->
          <ion-button
            *ngIf="role === 'professor'"
            slot="end"
            size="small"
            color="danger"
            (click)="cancelarAula(item.id)">
            Cancelar
          </ion-button>

          <ion-button
            *ngIf="role === 'professor' && item.status !== 'confirmado'"
            slot="end"
            size="small"
            color="success"
            (click)="confirmarAula(item.id)">
            Confirmar
          </ion-button>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Nenhuma aula -->
  <p *ngIf="selectedDate && !isLoading && agendaItems.length === 0" class="ion-text-center ion-padding">
    Nenhuma aula para esta data.
  </p>

  <!-- Spinner -->
  <ion-spinner *ngIf="isLoading" name="dots" class="ion-margin-top"></ion-spinner>

</ion-content>
